<!DOCTYPE html><html>  <head>    <title>query</title>    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <link href="../../css/main.css" rel="stylesheet" type="text/css">    <script type="text/javascript" src="/jsc/app.js"></script>  </head>  <body>    <article class="content">      <script type="text/javascript" src="/jsc/ydn.db-dev.js"></script>      <script type="text/javascript" src="/js/ydn-db/customer.js"></script>      <div dir="ltr">        <h2><a name="TOC-Query">Query iteration or cursor <br>          </a></h2>        <a name="TOC-Query">          <p>Query is used when you do not know the object key <em>exactly</em>.            In fact, IndexedDB do not have query processor but instead open a            stream of records, called <em>cursor</em>, in an object store.            Cursor can be open for the whole object store or&nbsp;subset&nbsp;of            them by limiting boundary by key(s). Records can be stream forward            or&nbsp;backward. <br>          </p>          <p>A <i>store-wise cursor</i> can be constructed from a database            instance by specifying <i>object store</i> name as follow: </p>          <pre>q = new ydn.db.Cursor('customer')</pre>          <p> This will iterate all records in the <code>customer</code> object            store. </p>        </a>        <p><a name="cursor">Use </a><a href="/ydn-db/using/key-range-query.html">key            range</a>, to define&nbsp;a subset of an object store: </p>        <pre>var direction = 'next'; // could be 'prev'var index = 'age'; // optional, if not defined index is in primary keyvar lower_boundary_key = 18;var upper_boundary_key = 19;q = new ydn.db.Cursor('customer', direction, index, lower_boundary_key, upper_boundary_key)</pre>        <p>It will enumerate records from <code>18</code> to <font color="#006000"            face="monospace">19</font>&nbsp;inclusive          of <i>indexed</i> field <code>age</code>&nbsp;of the record on <code>customer</code>          object store.&nbsp;</p>        <p>The method to retrieve the result is&nbsp;<code>fetch()&nbsp;</code>method,          which list values of records as <code>Array</code> in deferred          function as follow:</p>        <pre>results = db.fetch(q)results.done(print_it)</pre>        <p>For convenient, <code>get()</code> method is available to query for          fetching only one result as <code>Object</code>. </p>        <p>In addition to fetching all the result as a list, we can preform map,          reduce and filter operations to the resulting record during cursor          iteration. These <a href="file:///ydn-db/using/query-iterations.html">iteration            methods</a>, which we will be describing details in later section. </p>        <h2><a name="TOC-Query">Query</a></h2>        <p>Cursor are very low level and not descriptive. For example, to query          an aggregate property like <code>SUM</code> or <code>COUNT</code>, <em>map            iteration function</em> and <em>reduce iteration function</em>          function must be provided to the cursor. Here we describe how we could          achieved SQL query like processing using <code>ydn.db.Query</code>. </p>        <p>Above query can be rewrite as follow:</p>        <pre>var sql = ''; var params = [];q = new ydn.db.Query(sql, params);q.from('customer').where('age', '&gt;=', 18, '&lt;=', 19);results = db.fetch(q)results.done(print_it)</pre> Currently SQL statement parser are not implemented in the library. So we        are using query constructor methods here.<br>        <p></p>        <p>Cursor is native for IndexedDB. And, in fact, query are transformed          into cursor to execute the fetch method. It seems like query is          synthetic sugar to cursor. But it is more than that. Since query          object do not have function reference, query object can be transported          from one thread to another or persist on somewhere else for later use.          Moreover some part of query are execute natively in WebSQL. You can          find out using <code>explain</code> method. &nbsp; <br>        </p>        <h4><a name="TOC-WHERE">WHERE</a></h4>        <a name="TOC-WHERE">          <p>WHERE predicate filter the result by executing given conditions.            Record for which the predicate evaluates to falsy value are excluded            in the query result. </p>          <pre>q = new ydn.db.Query();q = q.from('customer').where('age', '&gt;=', 18 , '&lt;', 25).where('sex', '=', 'FEMALE');young_girls = db.fetch(q)young_girls.done(print_it)</pre>          <p>The first arguments is field name, the second argument is query            operator and the last to the value to evaluate&nbsp;against.</p>        </a>        <h4><a name="TOC-WHERE"></a><a name="TOC-SELECT">SELECT</a></h4>        <a name="TOC-SELECT">          <p> A SELECT statement retrieves fields from the iteration record to            generated a transformed object. </p>          <pre>q = new ydn.db.Query();q = q.from('customer').select('select', ['email', 'first'])db.fetch(q).done(print_it)</pre> </a>        <h3><a name="TOC-SELECT"></a><a name="TOC-Aggregations"> Aggregations</a></h3>        <a name="TOC-Aggregations"> </a>        <h4><a name="TOC-Aggregations"></a><a name="TOC-count">count</a></h4>        <a name="TOC-count">          <p>Emulate SQL <code>COUNT</code> method. </p>          <pre>q = new ydn.db.Query();q = q.from('customer').select('count')db.fetch(q).done(print_it)</pre> </a>        <h4><a name="TOC-count"></a><a name="TOC-sum">sum</a></h4>        <a name="TOC-sum">          <p>Emulate SQL <code>SUM</code> method. </p>          <pre>q = new ydn.db.Query();q = q.from('customer').select('sum', 'age')db.fetch(q).done(print_it)</pre> </a>        <h4><a name="TOC-sum"></a><a name="TOC-average">average</a></h4>        <a name="TOC-average">          <p>Emulate SQL <code>AVERAGE</code> method. </p>          <pre>q = new ydn.db.Query();q = q.from('customer').select('avg', 'age')db.fetch(q).done(print_it)</pre> </a></div>      <a name="TOC-average"> </a></article>    <a name="TOC-average">      <script type="text/javascript">initDom()</script> </a>  </body></html>