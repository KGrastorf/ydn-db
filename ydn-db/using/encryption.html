<!DOCTYPE html>
<html>
<head><title>Encryption</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script type="text/javascript" src="/jsc/app.js"></script>

</head>
<body>
<article class="content">

        <h2>Transparent Data Encryption </h2>
        <p>Browser database are mainly secured by <a href="http://www.w3.org/Security/wiki/Same_Origin_Policy">single origin policy</a>, such that only your web application can access the database. This is good enough for most web application. However, if user OS is compromised or physically accessible by intruders, browser database has no security provision. Transparent data encryption is a well-known technology provided by YDN-DB that
            offers encryption of data at rest. This may provide the ability to comply with many laws, regulations, and guidelines established in various industries, when caching sensitive data on client side. </p>
    <h3>Enabling store wise encryption</h3>
    <p>Application must provide
        cryptographically strong pseudo-random encryption key on opening the
        database for encryption. Use standard symmetric key generation library available on your server. Do not persist encryption key on client, but always transfer over SSL after user login. The key should be generated per user basic.</p><p> Encryption key(s) are provided as <code>Encryption</code> field on database options. Encryption is enabled on store-wise using same encryption key for whole database. To enable encryption a store, set
        <code>encrypted</code> to <code>true</code> on its store schema.
    </p>
        <p>Encrypted store must use out-of-line key and must not use key generator as illustrated in following schema. The following code snippets can be run on browser dev console.</p>
<pre> var schema = {
    version: 1,
    stores: [{
      name: 'encrypt-store',
      encrypted: true
    }]
  };
  var options = {
    Encryption: {
      expiration: 1000*15, //  optional data expiration in ms.
      secrets: [{
        name: 'aaaa',
        key: 'aYHF6vfuGHpfWS*eRLrPQxZjSó~É5c6HjCscqDqRtZasp¡JWSMGaW'
      }]
    }
  };

  var db = new ydn.db.Storage('encrypted-db-name', schema, options);
</pre>
    <p>Record key is hashed with SHA256 function using given encryption key. The field, <code>secrets</code>, has array of encryption <code>key</code> and <code>name</code>. A short key name is keep along with the unencrypted record for later used. Record value is encrypted with RC4 streaming cipher using per-record 64-bit random salt and encryption key. AES and CBC cipher is also available. See <a href="http://docs.closure-library.googlecode.com/git/class_goog_crypt_Sha256.html">goog.crypt.Sha256</a> and <a href="http://docs.closure-library.googlecode.com/git/class_goog_crypt_Arc4.html">goog.crypt.Arc4</a> for detail implementation.</p>
    <p>You may also set <code>expiration</code> interval in milli-seconds to let record to be expired. However noted that the data itself does not expired. The expiration time is a meta data to check on retrieval. If it expires, the record is removed from the database. These meta data can be manipulated if encryption is successful.</p>
    <p>Inside database, encrypted record value has four meta data 1) key name 2) salt 3) creation timestamp 4) expiration time and encrypted value. Since record key is hashed, both encryption key and record key is required to retrieve a correct record.</p>

    <h3>Using encryption</h3>
    <p>Once enabled encryption, record is encrypted on write and decrypted back on read. Encryption and decryption is performed only on CRUD database
        operations. Database query, such as <code>keys</code>,
        <code>values</code>, returns unencrypted values.</p>

    <pre>var value = {msg: 'Hello world'};
var id = 'id1';
db.put('encrypt-store', value, id); // value and record_id encrypted on database
db.values('encrypt-store').done(function(values) {
    console.log(values); // unencrypted values
});
db.get('encrypt-store', id).done(function(value) {
    console.log(value); // decrypted record value
});
</pre>
    <p>Since data is encrypted, database indexing is not available.</p>
    <p>In this example, you will also find that record can no longer be retrieved after expiration of 15 seconds.  </p>
    <p>Note that enabling encryption itself, does not encrypt data.</p>
    <h2>Encryption key rotation</h2>
    <p>With symmetric encryption, the level of confidentiality depends on the protection of the keys. To reduce exposure of key, encryption keys are updated periodically.</p>
    <p>Multiple encryption keys can be provided. Only the first key is used for encryption. All keys are used for decryption until success. Decryption is deem considered success if require key is available and encrypted value can be parsed by JSON parser.</p>
    <p>See <a href="http://yathit.github.io/sample-encryption/index.html">demo application</a> to try out.</p>
    <p>Additional source code is available upon request.</p>
</article>
<script type="text/javascript">initDom()</script>
<script type="text/javascript" src="http://yathit.github.io/sample-encryption/js/ydn.db-isw-core-crypt-qry-dev.js"></script>
</body>
</html>