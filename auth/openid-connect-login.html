<!DOCTYPE html><html><head><title>OpenID Connect login</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><script type="text/javascript" src="/jsc/app.js"></script></head><body><article class="content"><script type="text/javascript" src="/jsc/ydn.auth-min.js"></script><div dir="ltr"><h2><a name="TOC-OpenID-Connect-login" />OpenID Connect login</h2>
<p>Recently, a new standard, <a href="http://openid.net/connect/" >OpenID Connect</a>, allows pure static web site to authenticate with OpenID provider securely. OpenID Connect is base on OAuth 2.0 protocol. Similar to it, when user login to the OpenID provider, like Google or Facebook, the provider redirect back to the web site giving login assertion token, which the web app must verify upon receiving it. </p>
<h3><a name="TOC-Setup" />Setup</h3>
First include the YDN-login module, which give a single global variable ydn.api.App
<pre>    &lt;script type="text/javascript" src="ydn-login-min-x.x.js"&gt;&lt;/script&gt;</pre>
<div class="box">
    This page is attached with YDN-login module script, so that you can copy and paste the code snippets to your browser console to see in action.
</div>
<p>Setup the OpenID Connect provider as follow:</p>
<pre>var options = {
  app_id:'test',
  openid_client:{
    'end_point':'https://accounts.google.com/o/oauth2/auth',
    'client_id':'770204363449.apps.googleusercontent.com',
    'redirect_url': location.href.replace(/(\?|#)\S*/, ''), // clean up url
    'scope':'https://www.googleapis.com/auth/userinfo.email',
    'verify_url':'https://www.googleapis.com/oauth2/v1/tokeninfo'
  }
};
app = new ydn.api.App(options);
</pre>
<p>OpenID client setting are given from the respective OpenID provider. For Google, see <a href="https://developers.google.com/accounts/docs/OAuth2Login">Using OAuth 2.0 for Login</a>. Redirect url is tie to the origin and client id, so it is not possible to abuse <code>client_id </code>by others simply by copying the code. </p>
<p>Get the user object as follow:</p>
<pre>user = app.getUser()
</pre>
<p>See <a href="/auth/ydn-login-client.html">YDN login client section</a> for detail about user object.</p>

<h3><a name="TOC-User-presenter" />User presenter</h3>
<div><br />
</div>
Ydn-login module adopt Model-View-Presenter design pattern, in which user object is a presenter. Usually user object is setup with a user display as follow:

<pre>var login_ele = document.createElement('a');
var nickname_ele = document.createElement('span');
var base = document.createElement('div');
base.appendChild(login_ele);
base.appendChild(nickname_ele);
document.getElementsByTagName('h3')[1].appendChild(base);
var user_display = {
  setLoginUrl: function(label) {
    login_ele.textContent = 'login';
    login_ele.href = label;
  },
  setLogoutUrl: function(label) {
    login_ele.textContent = 'logout';
    login_ele.href = label;
  },
  setNickname: function(label) {
    nickname_ele.textContent = label;
  }
};

user.setView(user_display);
user.refresh(true); // this will update user display</pre>
<p>Follow the login url to login. After login to the OpenID provider login portal, it will redirect to this page again.</p>
<p>After login redirection, notice the token and nonce in the URL hash fragment. Extract it by refreshing</p>
<pre>user.refresh()
user.getEmail()
</pre>
<p>You should be able to get login user email. Being base on Oauth 2.0 means, login token also have authorization tokens too. We will discuss this on authorization session.</p>
<p>See full application in <a href="http://dev.yathit.com/demo/ydn-login/demo_app.js" >demo_app.js</a>
    in <a href="http://dev.yathit.com/demo/ydn-login/demo_app.html" >Login Demo App.</a></p></div></article><script type="text/javascript">initDom()</script></body></html>